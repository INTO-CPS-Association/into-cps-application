<form *ngIf="isLoaded" [formGroup]="form">
	<div class="form-horizontal">
		<panel id="tools" [title]="'Tools'" [open]="false">
			<div class="form-group">
				<div class="col-sm-7 col-md-8">
					<div class="input-group">
						<span class="input-group-btn">
							<button type="button" (click)="addDtpItem('tool')" class="btn btn-default">
								New tool 
								<span class="glyphicon glyphicon-plus"></span>
							</button>
						</span>
					</div>
				</div>
			</div>

			<div class="constraint-container">
				<div class="panel panel-default constraint-panel" *ngFor="let entry of toolsWithEditing | keyvalue; let i = index">
					<div class="panel-heading btn-panel-heading">
						<div class="btn-group panel-heading-btn-group pull-right">
							<button class="btn btn-default" title="Edit tool" (click)="onEditDtpItem(entry)" *ngIf="!entry.value">
								<span class="glyphicon glyphicon-edit"></span>
							</button>
							<button class="btn btn-default" title="Save tool" (click)="onSaveDtpItem(entry)" *ngIf="entry.value" [disabled]="!form.get('tools').at(i).valid">
								<span class="glyphicon glyphicon-floppy-saved"></span>
							</button>
							<button class="btn btn-default" title="Remove tool" (click)="removeDtpItem(entry.key)">
								<span class="glyphicon glyphicon-remove"></span>
							</button>
						</div>
					</div>
					<div class="panel-body">
						<tool [tool]="entry.key" [editing] = "entry.value" [formGroup]="form.get('tools').at(i)"></tool>		
					</div>
				</div>
			</div>
		</panel>

		<panel id="servers" [title]="'Servers'" [open]="false">
			<div class="form-group">
				<div class="col-sm-7 col-md-8">
					<div class="input-group">
						<span class="input-group-btn">
							<button type="button" (click)="addDtpItem('server')" class="btn btn-default">
								New server 
								<span class="glyphicon glyphicon-plus"></span>
							</button>
						</span>
					</div>
				</div>
			</div>

			<div class="constraint-container">
				<div class="panel panel-default constraint-panel" *ngFor="let entry of serversWithEditing | keyvalue; let i = index">
					<div class="panel-heading btn-panel-heading">
						<div class="btn-group panel-heading-btn-group pull-right">
							<button class="btn btn-default" title="Edit server" (click)="onEditDtpItem(entry)" *ngIf="!entry.value">
								<span class="glyphicon glyphicon-edit"></span>
							</button>
							<button class="btn btn-default" title="Save server" (click)="onSaveDtpItem(entry)" *ngIf="entry.value" [disabled]="!form.get('servers').at(i).valid">
								<span class="glyphicon glyphicon-floppy-saved"></span>
							</button>
							<button class="btn btn-default" title="Remove server" (click)="removeDtpItem(entry.key)">
								<span class="glyphicon glyphicon-remove"></span>
							</button>
						</div>
					</div>
					<div class="panel-body">
						<server [server]="entry.key" [editing] = "entry.value" [formGroup]="form.get('servers').at(i)"></server>			
					</div>
				</div>
			</div>
		</panel>

		<panel id="configurations" [title]="'Configurations'" [open]="false">

			<div class="form-group">
				<div class="col-sm-7 col-md-8">
					<div class="input-group">
						<span class="input-group-btn">
							<button type="button" (click)="addDtpItem('configuration')" class="btn btn-default">
								New configuration 
								<span class="glyphicon glyphicon-plus"></span>
							</button>
						</span>
					</div>
				</div>
			</div>

			<div class="constraint-container">
				<div class="panel panel-default dtp-outer-constraint-panel" *ngFor="let entry of configurationsWithEditing | keyvalue; let i = index">
					<div class="panel-heading btn-panel-heading">
						<div class="btn-group panel-heading-btn-group pull-right">
							<button class="btn btn-default" title="Edit configuration" (click)="onEditDtpItem(entry)" *ngIf="!entry.value">
								<span class="glyphicon glyphicon-edit"></span>
							</button>
							<button class="btn btn-default" title="Save configuration" (click)="onSaveDtpItem(entry)" *ngIf="entry.value" [disabled]="!form.get('configurations').at(i).valid">
								<span class="glyphicon glyphicon-floppy-saved"></span>
							</button>
							<button class="btn btn-default" title="Remove configuration" (click)="removeDtpItem(entry.key)">
								<span class="glyphicon glyphicon-remove"></span>
							</button>
						</div>
					</div>
					<div class="panel-body">
						<task-configuration [configuration]="entry.key" [editing] = "entry.value" [formGroup]="form.get('configurations').at(i)" [config]="config"></task-configuration>		
					</div>
				</div>
			</div>
		</panel>
	</div>
	
	<div>
		<button class="btn btn-default" (click)="validateConfig()">
			<span class="glyphicon glyphicon-edit" aria-hidden="true"></span> Validate
		</button>
		<p *ngIf="isConfigValid">Config is valid</p>
	</div>
</form>